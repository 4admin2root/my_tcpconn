dist: trusty
sudo: required

language: python
python:
  - "2.7"
  # PyPy versions
addons:
  sonarcloud:
    organization: "4admin2root-github"
    token:
      secure: "$SONAR_TOKEN"

# command to install dependencies
install:
  #- pip install .
  - pip install -r requirements.txt
# command to run tests
services:
  - "redis-server"
script:
  - "sed -i '/REDIS_HOST/d' config.py && echo -e \"REDIS_HOST = 'localhost'\" >> config.py"
  - "sed -i '/SERVER_HOST/d' config.py && echo -e \"SERVER_HOST = 'localhost'\" >> config.py"
  - "python server.py &"
  - "sleep 5"
  - "python client.py &"
  - "sleep 5"
  - "cat logs/my_tcpconn.log"
  - "curl -H \"Content-type: application/json\" -X POST -d '{\"tcp_conn_key\": \"tc_10.9.3.14_10.9.3.27_27017\", \"tcp_conn_value\": 100, \"tcp_conn_interval\": 60}' http://localhost:5000/tc/api/v1.0/tclist"
  - "curl -X GET http://localhost:5000/tc/api/v1.0/tclist"
  - "curl -X GET http://localhost:5000/tc/api/v1.0/topo.html"
  - "curl -X GET http://localhost:5000/tc/api/v1.0/chord.html"
  - "curl -X GET http://localhost:5000/tc/api/v1.0/bar.html"
  - "curl -X GET http://localhost:5000/"
  - sonar-scanner

cache:
  directories:
    - '$HOME/.sonar/cache'
